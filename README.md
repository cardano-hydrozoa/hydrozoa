<p align="center">
  <h1 align="center">Hydrozoa</h1>
  <p align="center">State channel L2 for Cardano</p>
</p>

# Getting Started

Depending on your preferences, consider the following options:

* Play with Hydrozoa network running it locally =>
  `goto` [demo](https://github.com/cardano-hydrozoa/hydrozoa/tree/euo/metrics-dahboard/demo)
* Build and read the latest specification =>
  `goto` [specification](https://github.com/cardano-hydrozoa/hydrozoa/tree/euo/metrics-dahboard/specification)
* Download a pre-built [spec](https://drive.google.com/file/d/1O2QeARutrNf7wZA1GExioWlnS9XMLJ07/view)
* Join discussions on GH => goto [discussion](https://github.com/cardano-hydrozoa/hydrozoa/discussions)
* Start hacking by picking up an issue =>
  goto [issues: help wanted](https://github.com/cardano-hydrozoa/hydrozoa/issues?q=is%3Aissue%20state%3Aopen%20label%3A%22help%20wanted%22)

# Developer's Guide

## Prerequisites

You'll need Java JDK 21+, [scala-cli](https://scala-cli.virtuslab.org/) or [sbt](https://www.scala-sbt.org/)
of proper versions.
The preferred way is to use `Nix`. Install a fresh version of the Nix package manager
and run `nix develop` to drill into a dev-shell with all the dependencies needed.

## Setting up IntelliJ IDEA

`File` -> `New` -> `Project from Existing Sources` -> `select the project directory`
-> `Import project from external model` -> `BSP` -> `Sbt`

## Building with `sbt`

Run `sbt` to enter the sbt shell.

Run `compile` to compile the project.

Run `test` to run the tests.

## Running

### Private Network

Currently, Hydrozoa works against a private network backed with
[Yaci DevKit](https://github.com/bloxbean/yaci-devkit).
Here is the [link](https://devkit.yaci.xyz/docker) to the installation page.

Enter `devkit`'s CLI, create the node, and run it:

```shell
devkit start
> create-node -o
> start
```

#### Resetting the local Cardano node

If you need to reset the local testnet, run this command (in the `devkit` shell):

```shell
reset
```

### Running Hydrozoa Network

If you use IDEA, check out configurations in `.run` folder.

Otherwise:

* __Main class__: `hydrozoa.HydrozoaNode`
* __CLI arguments__:
    * Alice: `Alice 8093 9400`
    * Bob: `Bob 8094 9401`
    * Carol: `Carol 8095 9402`

### Testing

In addition to unit tests in the main codebase, there is also `integration` project
which contains several test suites, including a model-based test suite.
For now, these test suites need to be updated, please refer to issue #111.

## Note on terminology

In an attempt to minimise potential confusion coming from the use of the word "reference"
as an identifier of a utxo and for a utxo that a transaction accesses in a read-only manner
we use the following terms:

```
TxId = tx hash
TxIx = tx output index
UtxoId = (TxId, TxIx) // AKA OutputReference
UtxoSet = Map UtxoId Utxo
Utxo = (UtxoId, Output)
Output = Output (i.e. address, value, datum, script)
inputIds :: Set UtxoId = output references of the transaction's inputs
refInputIds :: Set UtxoId = output reference of the transaction's reference inputs
```

## Build the specification

Build this project's PDF specification from the LaTeX files in the `specification` subdirectory.

Please ensure that [nix is installed](https://nixos.org/download/#download-nix) in your system
and [flakes are enabled](https://nixos.wiki/wiki/Flakes).

Build in one step:

```bash
make spec
```

Clean all files generated by `make spec`:

```bash
make spec-clean
```

Find more instructions on working with the spec in `specification/README.md` file.
